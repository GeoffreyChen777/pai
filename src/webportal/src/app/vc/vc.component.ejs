<section class='content-header'>
  <%= breadcrumb({ breadcrumbTitle: "Virtual Clusters" }) %>
</section>

<section class='content'>
  <div class='box'>
    <div class='box-body'>
        <h3>Common VC</h3>
        <div>Common VCs split physical cluster by percentage. The sum of common VC's capacity should equal to 100%.</div>
        <% if (isAdmin === 'true') { %>
          <button class="btn btn-success btn-lg add-vc-btn" id="virtualClustersBtn" onclick="virtualClusterShow()">Add Common VC</button>
          <% } %>
          <table id='common-table' class='table table-bordered table-hover table-condensed' style='vertical-align:middle'>
            <thead>
              <tr>
                <th>Name</th>
                <th>Capacity</th>
                <th>Bonus</th>
                <th>Utilization</th>
                <th>Memory</th>
                <th>CPUs</th>
                <th>GPUs</th>
                <th>Active Jobs</th>
                <th>State</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% for (let vcName in data) { %>
                <% if (specifiedVc && vcName !== specifiedVc) continue; %>
                  <% if (data[vcName]['dedicated'] === false) { %>
                  <tr>
                    <td>
                      <a href="virtual-clusters.html?vcName=<%= vcName %>"><%= vcName %></a>
                    </td>
                    <td>
                      <%= formatNumber(data[vcName]['capacity'], 2) %> %
                    </td>
                    <td>
                      <%= data[vcName]['capacity'] < data[vcName]['maxCapacity'] ? 'enabled' : 'disabled' %>
                    </td>
                    <td>
                      <%= formatNumber(data[vcName]['capacity'] === 0 ? 0 : data[vcName]['usedCapacity'] / data[vcName]['capacity'] * 100, 2) %> %
                    </td>
                    <td>
                      <%= Math.floor(data[vcName]['resourcesUsed']['memory']) %> / <%= Math.floor(data[vcName]['resourcesTotal']['memory']) %> MB
                    </td>
                    <td>
                      <%= Math.floor(data[vcName]['resourcesUsed']['vCores']) %> / <%= Math.floor(data[vcName]['resourcesTotal']['vCores']) %>
                    </td>
                    <td>
                      <%= Math.floor(data[vcName]['resourcesUsed']['GPUs']) %> / <%= Math.floor(data[vcName]['resourcesTotal']['GPUs']) %>
                    </td>
                    <td>
                      <%= data[vcName]['numJobs'] %>
                    </td>
                    <td width="8%">
                      <%= convertState(vcName, data[vcName]['status']) %>
                    </td>
                    <td>
                      <a href="job-list.html?vcName=<%= vcName %>">View Jobs</a>
                      &nbsp;&nbsp;|&nbsp;&nbsp;
                      <a href="<%= yarnWebPortalUri %>/cluster/scheduler?openQueues=<%= vcName %>" target="_blank">Go to Yarn Page</a>
                      <% if (isAdmin === 'true') { %>
                        &nbsp;&nbsp;|&nbsp;&nbsp;
                        <a onclick="deleteVcItem('<%= vcName %>')" class="<%= vcName === 'default' ? 'default' : 'item-btn' %>">Delete</a>
                        &nbsp;&nbsp;|&nbsp;&nbsp;
                        <a onclick="editVcItem('<%= vcName %>', '<%= formatNumber(data[vcName]['capacity'], 2) %> %')" class="<%= vcName === 'default' ? 'default' : 'item-btn' %>">Edit</a>
                      <% } %>
                    </td>
                  </tr>
                  <% } %>
                <% } %>
            </tbody>
          </table>
    </div>
  </div>
  <div class='box'>
    <div class='box-body'>
        <h3>Dedicated VC</h3>
        <div>Dedicated VCs exclude some nodes from cluster for specific usage, currently we provide cmdline tool to manage them.</div>
        <table id='dedicated-table' class='table table-bordered table-hover table-condensed' style='vertical-align:middle'>
          <thead>
            <tr>
              <th>Name</th>
              <th>Utilization</th>
              <th>Memory</th>
              <th>CPUs</th>
              <th>GPUs</th>
              <th>Active Jobs</th>
              <th>State</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% for (let vcName in data) { %>
              <% if (specifiedVc && vcName !== specifiedVc) continue; %>
                <% if (data[vcName]['dedicated'] === true) { %>
                <tr>
                  <td>
                    <a href="virtual-clusters.html?vcName=<%= vcName %>"><%= vcName %></a>
                  </td>
                  <td>
                    <%= formatNumber(data[vcName]['capacity'] === 0 ? 0 : data[vcName]['usedCapacity'] / data[vcName]['capacity'] * 100, 2) %> %
                  </td>
                  <td>
                    <%= Math.floor(data[vcName]['resourcesUsed']['memory']) %> / <%= Math.floor(data[vcName]['resourcesTotal']['memory']) %> MB
                  </td>
                  <td>
                    <%= Math.floor(data[vcName]['resourcesUsed']['vCores']) %> / <%= Math.floor(data[vcName]['resourcesTotal']['vCores']) %>
                  </td>
                  <td>
                    <%= Math.floor(data[vcName]['resourcesUsed']['GPUs']) %> / <%= Math.floor(data[vcName]['resourcesTotal']['GPUs']) %>
                  </td>
                  <td>
                    <%= data[vcName]['numJobs'] %>
                  </td>
                  <td width="8%">
                    <%= convertState(vcName, data[vcName]['status']) %>
                  </td>
                  <td>
                    <a href="job-list.html?vcName=<%= vcName %>">View Jobs</a>
                    &nbsp;&nbsp;|&nbsp;&nbsp;
                    <a href="<%= yarnWebPortalUri %>/cluster/scheduler?openQueues=<%= vcName %>" target="_blank">Go to Yarn Page</a>
                  </td>
                </tr>
                <% } %>
              <% } %>
          </tbody>
        </table>
    </div>
  </div>
  <%= modal({'vcDefault': data.default}) %>
</section>
